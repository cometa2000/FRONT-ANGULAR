<!--begin::Modal content CREATE-->
<div class="modal-content">
    <!--begin::Modal header-->
    <div class="modal-header" id="kt_modal_add_user_header">
        <!--begin::Modal title-->
        <h2 class="fw-bolder">Add User</h2>
        
        <!--end::Modal title-->
        <!--begin::Close-->
        <div class="btn btn-icon btn-sm btn-active-icon-primary" data-kt-users-modal-action="close" (click)="modal.dismiss()">
            <!--begin::Svg Icon | path: icons/duotune/arrows/arr061.svg-->
            <span class="svg-icon svg-icon-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1" transform="rotate(-45 6 17.3137)" fill="currentColor" />
                    <rect x="7.41422" y="6" width="16" height="2" rx="1" transform="rotate(45 7.41422 6)" fill="currentColor" />
                </svg>
            </span>
            <!--end::Svg Icon-->
        </div>
        <!--end::Close-->
    </div>
    <!--end::Modal header-->
    <!--begin::Modal body-->
    <div class="modal-body scroll-y mx-5 my-3">
        <!--begin::Form-->
        <form id="kt_modal_add_user_form" class="form" action="#">
             <!--begin::Scroll-->
            <div class="d-flex flex-column scroll-y me-n7 pe-7" id="kt_modal_add_user_scroll" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-max-height="auto" data-kt-scroll-dependencies="#kt_modal_add_user_header" data-kt-scroll-wrappers="#kt_modal_add_user_scroll" data-kt-scroll-offset="300px">
                <!--begin::Input group-->
                <div class="fv-row row my-1">
                    <div class="col-6">
                        <label class="required fw-bold fs-6 mb-2">Nombre: </label>
                        <input type="text" name="name" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="Name" [(ngModel)]="name" />
                    </div>
                    <div class="col-6">
                        <label class="required fw-bold fs-6 mb-2">Apellido: </label>
                        <input type="text" name="surname" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="Surname" [(ngModel)]="surname" />
                    </div>
                </div>

                <div class="fv-row row my-1">
                    <div class="col-6">
                        <label class="required fw-bold fs-6 mb-2">Email: </label>
                        <input type="email" name="email" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="example@gmail.com" [(ngModel)]="email" />
                    </div>
                    <div class="col-6">
                        <label class="required fw-bold fs-6 mb-2">Phone: </label>
                        <input 
                            type="text" 
                            name="phone" 
                            class="form-control form-control-solid mb-3 mb-lg-0" 
                            placeholder="9999999999" 
                            [(ngModel)]="phone"
                            maxlength="10"
                            (keypress)="onlyNumbers($event)"
                            (paste)="onPaste($event)"
                        />
                        <small class="form-text text-muted">Debe contener exactamente 10 dígitos</small>
                    </div>
                </div>

                <div class="fv-row row my-1">
                    <div class="col-12">
                        <label class="required fw-bold fs-6 mb-2">Roles: </label>
                        <select
                            class="form-control form-select-solid fw-bolder"
                            name="role_selected"
                            placeholder="Selec. Rol"
                            [(ngModel)]="role_id"
                        >
                         <option value="">Selec. Rol</option>
                        <ng-container *ngFor="let rol of roles">
                            <option [value]="rol.id">{{ rol.name }}</option>
                        </ng-container>
                        
                        </select>
                    </div>
                </div>
                

                <div class="fv-row row my-1">
                    <div class="col-6">
                        <label class="required fw-bold fs-6 mb-2">Genero: </label>
                        <div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="gender" (click)="gender = 'MASCULINO'" id="gender1">
                                <label class="form-check-label" for="gender1">
                                  Masculino
                                </label>
                              </div>
                              <div class="form-check">
                                <input class="form-check-input" type="radio" name="gender" (click)="gender = 'FEMENINO'" id="gender2">
                                <label class="form-check-label" for="gender2">
                                  Femenino
                                </label>
                              </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <!-- Espacio vacío para mantener el diseño -->
                    </div>
                </div>

                <div class="fv-row row my-1">
                    <div class="col-6">
                        <label class="required fw-bold fs-6 mb-2">Tipo de documento: </label>
                        <select
                            class="form-control form-select-solid fw-bolder"
                            name="categorie"
                            placeholder="Selec. Tipo"
                            [(ngModel)]="type_document"
                        >
                            <option value="">Seleccionar tipo</option>
                            <option value="RFC">RFC</option>
                            <option value="CURP">CURP</option>
                            <option value="PASAPORTE">PASAPORTE</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="required fw-bold fs-6 mb-2">N° de documento: </label>
                        <input type="text" [(ngModel)]="n_document" name="n_document" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="Número de documento" />
                    </div>
                </div>

                <div class="fv-row row my-1">
                    <div class="col-6">
                        <label class="fw-bold fs-6 mb-2">Dirección: </label>
                        <textarea name="address" class="form-control form-control-solid" cols="20" rows="5" [(ngModel)]="address"></textarea>
                    </div>
                    <div class="col-6">
                        <label class="required fw-bold fs-6 mb-2">Seleccionar Avatar: </label>
                        
                        <!-- Avatar Preview -->
                        <div class="text-center mb-3" *ngIf="selectedAvatar">
                            <img [src]="getAvatarPath(selectedAvatar)" class="rounded" style="width: 100px; height: 100px; object-fit: cover;" alt="Avatar Preview">
                            <p class="text-muted small mt-2">Avatar seleccionado: {{ selectedAvatar }}</p>
                        </div>

                        <!-- Avatar Grid Selection -->
                        <div class="avatar-grid">
                            <div 
                                *ngFor="let avatar of availableAvatars" 
                                class="avatar-option"
                                [class.selected]="selectedAvatar === avatar"
                                (click)="selectAvatar(avatar)"
                            >
                                <img [src]="getAvatarPath(avatar)" [alt]="'Avatar ' + avatar">
                                <span class="avatar-number">{{ avatar.replace('.png', '') }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ✅ MODIFICACIÓN 1: Cambio de Radio Buttons a Select para Sucursales -->
                <div class="fv-row row my-1">
                    <div class="col-12">
                        <label class="required fw-bold fs-6 mb-2">Sucursal: </label>
                        <select
                            class="form-control form-select-solid fw-bolder"
                            name="sucursale_selected"
                            [(ngModel)]="sucursale_id"
                        >
                            <option value="">Seleccionar sucursal</option>
                            <ng-container *ngFor="let sucursal of sucursales">
                                <option [value]="sucursal.id">{{ sucursal.name }}</option>
                            </ng-container>
                        </select>
                    </div>
                </div>

                <!-- ⚠️ NOTA: Los campos de contraseña fueron removidos - La contraseña se genera automáticamente -->
                <div class="alert alert-info d-flex align-items-center p-3 mb-3">
                    <span class="svg-icon svg-icon-2hx svg-icon-info me-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path opacity="0.3" d="M20.5543 4.37824L12.1798 2.02473C12.0626 1.99176 11.9376 1.99176 11.8203 2.02473L3.44572 4.37824C3.18118 4.45258 3 4.6807 3 4.93945V13.569C3 14.6914 3.48509 15.8404 4.4417 16.984C5.17231 17.8575 6.18314 18.7345 7.446 19.5909C9.56752 21.0295 11.6566 21.912 11.7445 21.9488C11.8258 21.9829 11.9129 22 12.0001 22C12.0872 22 12.1744 21.983 12.2557 21.9488C12.3435 21.912 14.4326 21.0295 16.5541 19.5909C17.8169 18.7345 18.8277 17.8575 19.5584 16.984C20.515 15.8404 21 14.6914 21 13.569V4.93945C21 4.6807 20.8189 4.45258 20.5543 4.37824Z" fill="currentColor"/>
                            <rect x="9" y="13.0283" width="7.3536" height="1.2256" rx="0.6128" transform="rotate(-45 9 13.0283)" fill="currentColor"/>
                            <rect x="9.86664" y="7.93359" width="7.3536" height="1.2256" rx="0.6128" fill="currentColor"/>
                        </svg>
                    </span>
                    <div class="d-flex flex-column">
                        <span class="fw-bold">Contraseña temporal</span>
                        <span class="fs-7">Se generará automáticamente y se mostrará después del registro</span>
                    </div>
                </div>

            </div>
            <!--end::Scroll-->

            <!--begin::Actions-->
            <div class="text-center pt-15">
                <button type="reset" class="btn btn-light me-3" (click)="modal.dismiss()" [disabled]="isLoading | async">
                    Cerrar
                </button>
                
                <!-- ✅ MODIFICACIÓN 2: Botón de Registrar con Estado de Carga -->
                <button 
                    type="button" 
                    (click)="store()" 
                    class="btn"
                    [class.btn-primary]="!(isLoading | async)"
                    [class.btn-loading]="isLoading | async"
                    [disabled]="isLoading | async"
                    data-kt-users-modal-action="submit"
                >
                    <!-- Texto normal cuando NO está cargando -->
                    <span class="indicator-label" *ngIf="!(isLoading | async)">
                        Registrar
                    </span>

                    <!-- Spinner y texto cuando SÍ está cargando -->
                    <span class="indicator-progress" *ngIf="isLoading | async">
                        <span class="spinner-border spinner-border-sm align-middle me-2"></span>
                        Cargando...
                    </span>
                </button>
            </div>
            <!--end::Actions-->
        </form>
        <!--end::Form-->
    </div>
    <!--end::Modal body-->
</div>
<!--end::Modal content CREATE-->