<div class="checklists-container">
  <!-- Botón para añadir checklist (no desaparece) -->
  <button 
    class="btn-add-checklist"
    (click)="openModal()"
  >
    <i class="fas fa-check-square"></i>
    Añadir checklist
  </button>
</div>

<!-- Modal para crear/editar/copiar checklist -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>
        <i class="fas fa-check-square"></i>
        {{ editingChecklist ? 'Editar Checklist' : 'Nuevo Checklist' }}
      </h3>
      <button class="btn-close" (click)="closeModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <!-- Opción 1: Crear desde cero -->
      <div class="form-group">
        <label>Nombre del checklist:</label>
        <input 
          type="text" 
          class="form-control"
          [(ngModel)]="checklistName"
          placeholder="Ej: Tareas pendientes, Pasos a seguir..."
          maxlength="100"
          (keyup.enter)="saveChecklist()"
          [disabled]="isCopyMode"
          autofocus
        >
      </div>

      <!-- Separador visual -->
      <div class="separator" *ngIf="!editingChecklist">
        <span>O</span>
      </div>

      <!-- Opción 2: Copiar checklist existente -->
      <div class="form-group" *ngIf="!editingChecklist">
        <label>Copiar de un checklist existente:</label>
        <select 
          class="form-control"
          [(ngModel)]="selectedChecklistToCopy"
          (change)="onSelectChecklistToCopy()"
          [disabled]="checklistName.trim().length > 0"
        >
          <option [value]="null">-- Seleccionar checklist --</option>
          <option 
            *ngFor="let cl of availableChecklists" 
            [value]="cl.id">
            {{ cl.display_name }}
          </option>
        </select>
        <small class="form-text text-muted" *ngIf="selectedChecklistToCopy">
          <i class="fas fa-info-circle"></i>
          Se copiará el checklist con todos sus elementos (sin marcar como completados)
        </small>
        <small class="form-text text-muted" *ngIf="availableChecklists.length === 0 && !editingChecklist">
          <i class="fas fa-info-circle"></i>
          No hay checklists disponibles para copiar en este grupo
        </small>
      </div>

      <div class="info-box" *ngIf="!selectedChecklistToCopy && !editingChecklist">
        <i class="fas fa-info-circle"></i>
        <p>Los checklists te ayudan a organizar tareas en pasos más pequeños y medibles.</p>
      </div>
    </div>
    
    <div class="modal-footer">
      <button 
        class="btn btn-secondary" 
        (click)="closeModal()"
      >
        Cancelar
      </button>
      <button 
        class="btn btn-primary" 
        (click)="saveChecklist()"
        [disabled]="!canSaveChecklist()"
      >
        <i class="fas fa-save"></i>
        {{ editingChecklist ? 'Actualizar' : (selectedChecklistToCopy ? 'Copiar' : 'Crear') }}
      </button>
    </div>
  </div>
</div>