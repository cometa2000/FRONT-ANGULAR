<div class="modal-content" style="min-height: 90vh;">
  <!-- Modal Header -->
  <div class="modal-header">
    <h2 class="modal-title d-flex align-items-center">
      <!-- Icono según tipo de documento -->
      <i class="ki-duotone fs-1 me-3" 
         [ngClass]="{
           'ki-file-pdf text-danger': viewerType === 'pdf',
           'ki-file-jpg text-success': viewerType === 'image',
           'ki-file-word text-primary': documentInfo?.document_type === 'text',
           'ki-file-excel text-success': documentInfo?.document_type === 'spreadsheet',
           'ki-file-powerpoint text-warning': documentInfo?.document_type === 'presentation',
           'ki-file text-gray-600': viewerType === 'unknown'
         }">
        <span class="path1"></span>
        <span class="path2"></span>
      </i>
      
      <div class="d-flex flex-column">
        <span>{{ DOCUMENTO_SELECTED?.name }}</span>
        <small class="text-muted fs-7" *ngIf="documentInfo">
          {{ documentInfo.mime_type }}
          <span *ngIf="documentInfo.can_edit" class="badge badge-light-success ms-2">
            <i class="ki-duotone ki-pencil fs-6">
              <span class="path1"></span>
              <span class="path2"></span>
            </i>
            Editable
          </span>
        </small>
      </div>
    </h2>

    <div class="d-flex align-items-center gap-2">
      <!-- Botón de descarga -->
      <button 
        type="button" 
        class="btn btn-sm btn-light-primary"
        (click)="downloadDocument()"
        title="Descargar archivo">
        <i class="ki-duotone ki-download fs-2">
          <span class="path1"></span>
          <span class="path2"></span>
        </i>
        Descargar
      </button>

      <!-- Botón de cerrar -->
      <button 
        type="button" 
        class="btn btn-icon btn-sm btn-light-primary" 
        (click)="closeModal()">
        <i class="ki-duotone ki-cross fs-1">
          <span class="path1"></span>
          <span class="path2"></span>
        </i>
      </button>
    </div>
  </div>

  <!-- Modal Body -->
  <div class="modal-body p-0" style="min-height: 80vh;">
    
    <!-- Loading State -->
    <div *ngIf="isLoading" class="d-flex flex-column align-items-center justify-content-center" style="min-height: 80vh;">
      <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="text-muted">Cargando documento...</p>
    </div>

    <!-- PDF Viewer -->
    <div *ngIf="!isLoading && viewerType === 'pdf'" class="h-100">
      <iframe 
        [src]="safeUrl" 
        width="100%" 
        height="100%" 
        style="min-height: 80vh; border: none;"
        title="Visor de PDF">
      </iframe>
    </div>

    <!-- Image Viewer -->
    <div *ngIf="!isLoading && viewerType === 'image'" class="d-flex align-items-center justify-content-center p-5" style="min-height: 80vh; background-color: #f5f5f5;">
      <img 
        [src]="documentInfo.url" 
        [alt]="documentInfo.name"
        class="img-fluid"
        style="max-width: 100%; max-height: 80vh; object-fit: contain;">
    </div>

    <!-- OnlyOffice Editor -->
    <div *ngIf="!isLoading && viewerType === 'office'" class="position-relative">
      <!-- Contenedor de OnlyOffice -->
      <div id="onlyoffice-editor" style="width: 100%; height: 80vh;"></div>
      
      <!-- Información de ayuda -->
      <div class="position-absolute bottom-0 end-0 m-3" style="z-index: 1000;">
        <div class="badge badge-light-info">
          <i class="ki-duotone ki-information-5 fs-6 me-1">
            <span class="path1"></span>
            <span class="path2"></span>
            <span class="path3"></span>
          </i>
          {{ documentInfo?.can_edit ? 'Modo edición' : 'Solo lectura' }}
        </div>
      </div>
    </div>

    <!-- Unknown Type -->
    <div *ngIf="!isLoading && viewerType === 'unknown'" class="d-flex flex-column align-items-center justify-content-center text-center p-5" style="min-height: 80vh;">
      <i class="ki-duotone ki-file-down fs-5x text-muted mb-5">
        <span class="path1"></span>
        <span class="path2"></span>
      </i>
      <h3 class="text-gray-700">Formato no soportado</h3>
      <p class="text-muted mb-5">
        Este tipo de archivo no puede visualizarse en el navegador.<br>
        Puedes descargarlo para abrirlo con una aplicación externa.
      </p>
      <button 
        type="button" 
        class="btn btn-primary"
        (click)="downloadDocument()">
        <i class="ki-duotone ki-download fs-2 me-2">
          <span class="path1"></span>
          <span class="path2"></span>
        </i>
        Descargar Archivo
      </button>
    </div>

  </div>

  <!-- Modal Footer (opcional) -->
  <div class="modal-footer border-0 pt-0" *ngIf="documentInfo && !isLoading">
    <div class="d-flex justify-content-between w-100">
      <div class="text-muted fs-7">
        <i class="ki-duotone ki-user fs-6 me-1">
          <span class="path1"></span>
          <span class="path2"></span>
        </i>
        {{ documentInfo.user?.name }}
        <span class="mx-2">•</span>
        <i class="ki-duotone ki-calendar fs-6 me-1">
          <span class="path1"></span>
          <span class="path2"></span>
        </i>
        {{ documentInfo.created_at }}
      </div>
      
      <div class="text-muted fs-7" *ngIf="documentInfo.can_edit">
        <i class="ki-duotone ki-information-5 fs-6 me-1">
          <span class="path1"></span>
          <span class="path2"></span>
          <span class="path3"></span>
        </i>
        Los cambios se guardan automáticamente
      </div>
    </div>
  </div>
</div>